---
layout: post
title: "Swift 2ã§ã®APIKit + Himotoki"
date: 2015-07-29 19:32
---

Swift 2ã®åˆ©ç‚¹ã‚’æœ€å¤§é™ã«æ´»ã‹ã™ãŸã‚ã€APIKitã®ãƒ‡ã‚¶ã‚¤ãƒ³ã¯å¤§å¹…ã«åˆ·æ–°ã•ã‚Œã¾ã—ãŸã€‚å‹åˆ¶ç´„ã¤ãprotocol extensionsã¨Himotokiã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨`responseFromObject(_:URLResponse:)`ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…ã‚’ä¸ãˆã‚‰ã‚Œã‚‹ã®ã§ã€å€‹ã€…ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®šç¾©ã‚’æ¥½ã«ã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯ãã®ä¾‹ã§ã™ã€‚

```swift
// https://developer.github.com/v3/search/#search-repositories
struct SearchRepositoriesRequest: GitHubRequest {
    enum Sort: String {
        case Stars = "stars"
        case Forks = "forks"
        case Updated = "updated"
    }
    
    let query: String
    let sort: Sort
    
    init(query: String, sort: Sort = .Stars) {
        self.query = query
        self.sort = sort
    }
    
    // MARK: - Request
    typealias Response = PaginatedResponse<Repository>
    
    var method: HTTPMethod {
        return .GET
    }
    
    var path: String {
        return "/search/repositories"
    }
    
    var parameters: [String: AnyObject] {
        return [
            "q": query,
            "sort": sort.rawValue,
        ]
    }
}
```

å‹åˆ¶ç´„ã¤ãprotocol extensionsã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```swift
protocol GitHubRequest: Request {
    
}

extension GitHubRequest {
    var baseURL: NSURL {
        return NSURL(string: "https://api.github.com")!
    }
}

extension GitHubRequest where Self.Response: Decodable, Self.Response == Self.Response.DecodedType {
    func responseFromObject(object: AnyObject, URLResponse: NSHTTPURLResponse) -> Self.Response? {
        return decode(object) as Self.Response?
    }
}
```

å®šç¾©ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

```swift
let request = SearchRepositoriesRequest(query: "APIKit", sort: .Stars)

API.sendRequest(request) { result in
    switch result {
    case .Success(let response):
        for repository in response.items {
            print("\(repository.fullName) ğŸŒŸ\(repository.stargazersCount)")
        }
        
    case .Failure(let error):
        print("error: \(error)")
    }
}
```

ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“ã¯gistã«ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚

[https://gist.github.com/ishkawa/59dd67042289ee4b5cab](https://gist.github.com/ishkawa/59dd67042289ee4b5cab)
