{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/1573776089/",
    "result": {"data":{"site":{"siteMetadata":{"title":"ishkawa"}},"markdownRemark":{"id":"417a5b37-8dc7-50f9-8084-83a339076e97","excerpt":"GKEでは特に何も設定しなくても、同一プロジェクトのGCRのDockerイメージをpullできる。GCRはプライベートレジストリなので当然だが、プロジェクト外では認証が必要となる。今回は、ローカルのKubernetesでGCRのイメージをpull…","html":"<p>GKEでは特に何も設定しなくても、同一プロジェクトのGCRのDockerイメージをpullできる。GCRはプライベートレジストリなので当然だが、プロジェクト外では認証が必要となる。今回は、ローカルのKubernetesでGCRのイメージをpullしたかったので、その手順を残す。</p>\n<h2>サービスアカウントのキーを作成</h2>\n<p>まず、GCRの読み取り権限を持つサービスアカウントのキーをつくる。</p>\n<ol>\n<li>GCPのメニューから”API &#x26; Services” > “Credentials” > “Create Credentials” > “Service account key” > と進む。</li>\n<li>“Service account”には”New service account”を、“Role”には”Storage Object Viewer”を、“Key type”には”JSON”を設定して、キーを作成する。</li>\n</ol>\n<h2>Kubernetesのsecretの作成</h2>\n<p>続いて、以下のコマンドでsecretを作成する。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create secret docker-registry gcr-puller \\\n  --docker-server=gcr.io \\\n  --docker-username=_json_key \\\n  --docker-password=\"$(cat /path/to/service_account_key.json)\" \\\n  --docker-email=you@example.com</code></pre></div>\n<p>YAMLにエクスポートする場合は、以下のコマンドを実行する。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl get secret gcr-puller -o yaml > secret.yaml</code></pre></div>\n<h2>deploymentのimagePullSecretsを設定</h2>\n<p>最後に、deploymentの<code class=\"language-text\">imagePullSecrets</code>に作成したsecretを指定する。自分の場合、Kustomizeでローカル環境のみ<code class=\"language-text\">imagePullSecrets</code>を設定したかったので、以下のようなpatchを書いた。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: target-deployment\nspec:\n  template:\n    spec:\n      imagePullSecrets:\n      - name: gcr-puller</code></pre></div>\n<h2>参考</h2>\n<ul>\n<li><a href=\"https://blog.container-solutions.com/using-google-container-registry-with-kubernetes\">Using Google Container Registry with Kubernetes</a></li>\n</ul>","frontmatter":{"title":"ローカルのKubernetesでGCRのイメージをpullする","date":"2019/11/15","description":"","image":null}}},"pageContext":{"slug":"/1573776089/","previous":{"fields":{"slug":"/1564812367/"},"frontmatter":{"title":"既存アプリへのFlutterの導入"}},"next":{"fields":{"slug":"/1583660817/"},"frontmatter":{"title":"Dartのjson_serializableにカスタムの型変換を追加する"}}}},
    "staticQueryHashes": ["2841359383"]}